{% extends 'blog/base.html' %}
{% load widget_tweaks %}
{% load static %}

{% block title %}{% if form.instance.pk %}Edit Post{% else %}New Post{% endif %}{% endblock %}

{% block extra_head %}
  {{ form.media }}
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="{% static 'ckeditor/ckeditor-init.js' %}"></script>
  <script src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"></script>
  {% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <h2 class="mb-4 text-center">{% if form.instance.pk %}Edit Post{% else %}New Post{% endif %}</h2>
          
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="mb-4">
              <label for="{{ form.title.id_for_label }}">Title</label>
              {% render_field form.title class="form-control" placeholder="Enter your post title" %}
            </div>
            
            <div class="mb-4">
              <label for="{{ form.category.id_for_label }}">Category</label>
              {% render_field form.category class="form-select" %}
            </div>
            
            <div class="mb-4">
              <label for="{{ form.content.id_for_label }}">Content</label>
              {{ form.content }}
            </div>
            
            <div class="mb-4">
              <label for="{{ form.tags.id_for_label }}">Tags</label>
              {% render_field form.tags class="form-control" %}
            </div>
            
            <div class="mb-4">
              <label for="{{ form.head_image.id_for_label }}">Header Image</label>
              {% render_field form.head_image class="form-control" %}
            </div>
            
            <div class="mb-4">
              <label for="{{ form.file_upload.id_for_label }}">Attach File</label>
              {% render_field form.file_upload class="form-control" %}
            </div>
            
            {% if form.birthday %}
            <div class="mb-4">
              <label for="{{ form.birthday.id_for_label }}">Birthday</label>
              {% render_field form.birthday class="form-control" type="date" %}
            </div>
            {% endif %}
            
            {% if form.location %}
            <div class="mb-4">
              <label for="{{ form.content.id_for_label }}">Content</label>
              {{ form.content }}
            </div>
            {% endif %}
            
            <div class="d-grid">
              <button type="submit" class="btn btn-primary">
                {% if form.instance.pk %}Update{% else %}Share{% endif %}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Select2 initialization for tags
    $('#{{ form.tags.id_for_label }}').select2({
        tags: true,
        tokenSeparators: [',', ' '],
        placeholder: "Enter tags",
    });
});
</script>

<style>
body {
    background-color: #fafafa;
}
.form-control:focus, .form-select:focus {
    box-shadow: 0 0 0 0.2rem rgba(0,149,246,0.25);
    border-color: #0095f6;
}
.custom-file-upload input[type="file"] {
    display: none;
}
.custom-file-upload label {
    cursor: pointer;
    padding: 8px 12px;
    background-color: transparent;
    border: 1px solid #dbdbdb;
    color: #0095f6;
    transition: all 0.3s;
}
.custom-file-upload label:hover {
    background-color: rgba(0,149,246,0.1);
}
.btn-primary {
    background-color: #0095f6;
    border-color: #0095f6;
    font-weight: 600;
}
.btn-primary:hover {
    background-color: #0086e0;
    border-color: #0086e0;
}
.select2-container .select2-selection--multiple {
    min-height: 38px;
}
</style>
{% endblock %}