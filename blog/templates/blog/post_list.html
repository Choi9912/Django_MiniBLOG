{% extends 'blog/base.html' %}

{% block title %}Blog Posts{% endblock %}

{% block content %}
{% for post in posts %}
<div class="post-card">
    <div class="post-header">
        <img src="https://via.placeholder.com/32" alt="{{ post.author.username }} Avatar">
        <span class="username">{{ post.author.username }}</span>
        {% if user == post.author %}
            <a href="{% url 'post_update' post.pk %}" class="edit-link"><i class="fas fa-edit"></i></a>
        {% endif %}
    </div>
    <div class="post-image">
        {% if post.head_image %}
            <img src="{{ post.head_image.url }}" alt="{{ post.title }}">
        {% else %}
            <img src="https://via.placeholder.com/614x614" alt="No Image">
        {% endif %}
    </div>
    <div class="post-actions">
        <form action="{% url 'post_like_toggle' post.pk %}" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-link">
                {% if user in post.likes.all %}
                    <i class="fas fa-heart text-danger"></i>
                {% else %}
                    <i class="far fa-heart"></i>
                {% endif %}
            </button>
        </form>
        <a href="{% url 'post_detail' post.pk %}#comments"><i class="far fa-comment"></i></a>
    </div>
    <div class="post-likes">
        {{ post.likes.count }} likes
    </div>
    <div class="post-caption">
        <strong>{{ post.author.username }}</strong> {{ post.content|truncatechars:100 }}
    </div>
    <div class="post-comments">
        {% if post.comments.count > 0 %}
            <a href="{% url 'post_detail' post.pk %}#comments">View all {{ post.comments.count }} comments</a>
        {% endif %}
    </div>
    <form action="{% url 'comment_create' post.pk %}" method="post" class="comment-form">
        {% csrf_token %}
        <input type="text" name="content" placeholder="Add a comment..." required>
        <button type="submit"><i class="fas fa-paper-plane"></i></button>
    </form>
    <div class="post-details">
        <small>{{ post.created_at|date:"F d, Y" }}</small>
    </div>
</div>
{% endfor %}
{% endblock %}